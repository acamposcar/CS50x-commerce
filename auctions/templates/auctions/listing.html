{% extends "auctions/layout.html" %}

{% block body %}

    
        <div class="d-flex justify-content-center">
            <img src="{{listing.image_url}}" class="img-fluid " alt="">
        </div>

        <div>
            <h2>{{ listing.title }}</h2>
            <p>{{ listing.description|linebreaks }}</p>
            <h3><span class="badge badge-warning">Price: ${{ max_bid }}</span></h3>
            <p class="small">Max bid by {{ bid_user }}</p>
          
            <!-- Watchlist button -->
            {% if user.is_authenticated and user.id != listing.user.id %}
            <form action="{% url 'watchlist' %}" method="post">
                {% csrf_token %}
                {% if on_watchlist %}
                <input class="btn btn-primary" type="submit" value="Remove from watchlist">  
                <input type="hidden" name="add_watchlist" value="False">

                {% else %}

                <input class="btn btn-primary" type="submit" value="Add to watchlist">
                <input type="hidden" name="add_watchlist" value="True">
                {% endif %}

                <input type="hidden" name="listing_id" value="{{ listing.id }}">
            </form>
            {% endif %}

            {% if user.is_authenticated and user.id != listing.user.id %}
            <form action="{% url 'bids' %}" method="post">
                {% csrf_token %}
                <input type="number" required min="{{ max_bid }}" name="price">
                <input type="hidden" name="listing_id"  value="{{ listing.id }}">
                <input class="btn btn-primary" type="submit" value="Make bid">
                
            </form>
            {% endif %}

            {% if listing.closed == True %}
                <div class="alert alert-danger">Listing closed. Buyer: {{ bid_user }}</div>
            {% endif %}

            {% if user.is_authenticated and user.id == listing.user.id %}
            <form action="{% url 'close_listing' listing.id %}" method="post">
                {% csrf_token %}
                {% if listing.closed == False %}
                <input class="btn btn-primary" type="submit" value="Close Listing">
                {% else %}
                <input class="btn btn-primary" type="submit" value="Open Listing">
                {% endif %}
            </form>
            {% endif %}

            <p class="small">Created by {{ listing.user }} on {{ listing.date }}</p>
        </div>

        <hr>
        <h3>Comments</h3>
        {% if user.is_authenticated %}
        <form action="{% url 'listing_view' listing.id %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                {{ comment_form }}
            </div>
            <div class="form-group">
                <input class="btn btn-primary" type="submit" value="Save comment">
            </div>
        </form>
        {% else %}
            <div class="alert alert-warning">
             Log in to write a comment
            </div>
        {% endif %}
    {% for comment in comments %}
    <div class="card">
        <dl class="row card-body">
            <dt class="col-sm-2"><div>{{comment.user}}</div><small>{{comment.date}}</small></dt>
            <dd class="col-sm-10">{{comment.content|linebreaks}}</dd>
          </dl>
    </div>
        <!-- <p class="small">Created by {{ comment.user }} on {{ comment.date }}</p> -->
    {% endfor %}

</div>

    </ul>
    
{% endblock %}